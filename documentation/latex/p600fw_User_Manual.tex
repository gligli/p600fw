\documentclass[draft,landscape, 11pt, oneside]{report}
\usepackage[a4paper, left=2cm, right=2cm, top=2.5cm]{geometry}
%\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{hyperref}
\usepackage{titlesec}
\usepackage{scrextend}
\usepackage{array}
%\usepackage{fontspec}
\usepackage[inline]{showlabels}
%\setmainfont{FiraSans-SemiBold}
\setlength{\parindent}{0pt}
\setlength{\parskip}{1em}
\setlength{\leftmargin}{-4cm}
\setlength{\paperheight}{210mm}
\setlength{\paperwidth}{297mm}
\setlength{\textwidth}{26cm}
\setlength{\footskip}{2.5cm}
\renewcommand{\familydefault}{\sfdefault}

\newenvironment{flowtext}{\addmargin[0cm]{7cm}}{\endaddmargin} % standard text width (reduced for layout)

\title{[DRAFT] User Manual for the GliGli upgraded Prophet 600}
\author{Florian Merz (Editor)}
\pagestyle{myheadings}\markright{[DRAFT] User Manual for the GliGli upgraded Prophet 600}
\makeatletter
\renewcommand\chapter{\pagestyle{myheadings}\markright{[DRAFT] User Manual for the GliGli upgraded Prophet 600}\global\@topnum\z@\@afterindentfalse\secdef\@chapter\@schapter}
\makeatother
\titleformat{\chapter}[display]{\pagebreak\LARGE\bfseries}{}{0.0cm}{}
\titlespacing{\chapter}{0pt}{*0}{*0}
%\titleformat{\section}[display]{\Large\bfseries}{}{0.0cm}{}
\titlespacing{\section}{0pt}{*0}{*0}

\begin{document}

%\maketitle
\tableofcontents


\pagebreak
\chapter{Introduction to the GliGli Prophet 600 Firmware Upgrade}

\begin{flowtext}

\section{What you can expect from the Firmware Upgrade}

The credit of the original idea and implementation of the Prophet 600 firmware upgrade belongs to GliGli\cite{gligli}. He describes his motivation as follows:

\begin{addmargin}[2cm]{1cm}

\textit{I love vintage analog synthesizers, and to be honest, my dream synth would be a Prophet 5, but when I heard what the Prophet 600 was capable of tone wise, I immediately thought its major weaknesses -- the lousy computer part, software envelopes and LFO -- could become its strength with a remake; basically the whole internal synth in voltage-controlled from a nice 14bit DAC, so with a fast modern micro controller, it could become awesome, maybe even better than a Prophet 5!}

\end{addmargin}

The original Sequential Circuits Prophet 600 is run by a Z80 processor. This processor and firmware written for it reach their limits when computing the voltages, scanning user inputs and managing MIDI events making the instrment glitchy and non-responsive. GliGli reversed engineered the original firmware for the Z80 and found that the Z80 can be replaced by a (more) modern Teensy 2.0++ USB programmable microprocessor \cite{teensy}. The Teensy not only fits in to the 2x20 pin standard header but could also be programmed to take the role of Z80 with only slight modifications. In this way the limitations of the original Prophet 600 could be overcome - but more than that, it opened the possibility for new features (which may or may not have been on the feature list of Sequential Circuits). There are various modifications and modern CPU "implants" for some vintage analog synthesizers. One decisive advantage of the Teensy approach to the Prophet 600 is that it is an easy-to-install and non-destructive firmware drop-in replacement\footnote{There are two versions of the Prophet 600. One has the Z80 on a socket. In this case replacement is truly "drop-in". The other version has the Z80 soldered to the circuit board. In this case the Z80 needs to be removed a socket has to be soldered in its place first.}. So it is safe to try it out because one can always remove the Teensy board and restore the Z80 without technical expertise or training.

Developing the software was a major effort with low level functions at the core which deal with setting voltages to the electronic components, processing clock alignment, MIDI implementation, decoding the user inputs from dials, buttons and the keyboard and last but not least the "musical" coding of envelopes, modulations and sequencing functions. Many people have contributed, many out of curiosity and passion for synthesizers, most out of excitement that such a project could not only be conjured up but also be implemented and brought to life. The hardware of the Prophet 600 certainly justifies the effort: other than many DCO synths of the time the Prophet 600 is a 6 voice analog synthesizer driven by 12 voltage controlled oscillators (VCOs) and 24db low pass filters, all implemented using the famous Curtis chips\cite{curtis}. Furthermore, the hardware provides hard sync, ring modulation and modulation of cut-off by VCO. It is very versatile.

The following is a compact summary of the improved and the  new features which the upgraded Prophet 600 provides on this hardware. The manual refers to version 2.2 and differences between versions are marked or commented in the text. 

\begin{itemize}
  \setlength\itemsep{0cm}
  \item{General features}
  \subitem Greater resolution of many of the sound parameters with an improved refresh rate that is making the instrument much more responsive
  \subitem Faster and smoother ADSR envelopes with support two speed regimes (slow, fast) and two shapes (linear, exponential)
  \subitem positive and negative envelope amount settings for filter and poly-mod
  \subitem A new LFO function generator with a wider frequency range from one cycle every 20 seconds to about 60Hz
  \subitem Assignable, Random And Up/Down Arpeggiator sync-able to MIDI clock
  \subitem Multiple note assignment modes including last/low/high note priority
  \subitem Full MIDI In control including amplitude and filter velocity sensitivity with an external keyboard controller, continuous Controllers (CC) of all sound parameters, program change (PC) to choose current preset
  \subitem A dedicated vibrato which can be controlled by the modulation wheel, or can start progressively after a fixed amount of time
  \subitem Keyboard mode chord in addition to polyphonic and unison  
  \subitem Four new waveforms in addition to the original triangle and square including sine, random stepped, noise (like on the original Prophet 5, but non-periodic) and sawtooth (ramp up)
  \subitem Mix Overdrive which now allows the output from both oscillators to drive the mix VCAs A and B harder as well as the Curtis 4 pole filter resulting in new sonic possibilities
  \subitem Pitch Wheel interval selection of plus/minus one octave, a whole tone, a minor third and a fifth
  \subitem Pitch Wheel reassignment to the VCF and Volume or off   
  \subitem Modulation wheel intensity setting from Maximum to Medium to Minimum
  \subitem A new and improved tuning procedure
  \subitem Octave, chromatic and free Oscillator course pitch control
  \subitem Debounce feature that prevents unintended re-triggering caused by the old keyboard
  \item Features with version 2.1 RC3
  \subitem Polyphonic step sequencer
  \subitem Per note tuning
  \subitem Support for external CV
  \subitem Improved UI, introducing display of -50...48 range for bipolar dials and center deadband for better handling  
  \subitem VCF limit option
  \subitem Maintenance mode
  \subitem Support for pedal to sustain notes and to hold chords (in unison)
  \subitem On-the-lfly transpose function for arpeggiator and sequencer
  \item Features with version (t.b.d.)
  \subitem A new UI concept in preset mode in which the dials have a pick-me-up behaviour, in order to avoid discontinuous value changes and to make the differences between panel and internal values transparent 
  \subitem Flexible envelope routing allowing the poly-mod to by modulated by either envelope generator
  \subitem Possibility to sync the LFO to the thythm of the arpeggiator or sequencer
  \subitem Continuous spread parameter introducing voice variations in tune and envelopes
  \subitem Better MIDI integration possibilities through new local off mode
  \subitem Improved patch management via MIDI, supporting loading MIDI patch to active controls 
  \subitem Various improvements such as arppegiator / sequencer speed stability and reconciliation of internal and external bend  
  
\end{itemize}

\section{Versions of the firmware upgrade and compatibility}

The first stable version of the Firmware Upgrade was version 2.0 \cite{versiontwo}. An intermediate release (or at least something close to a release) version 2.1 Release Candidate 3 has been available from September 5th 2015 on \cite{gligli}. The current release is version (t.b.d.). 

Upgrading the firmware can be done by SysEx (or directly using the USB port of the Teensy board), see section \ref{fwupgrade}. When upgrading the Prophet 600 patch data and settings are preserved. Note that since this is an open source project different variants of the firmware upgrade have been developed by users. In the main development branch, however, backward compatibility is intended to be ensured. This applies in particular to patches and settings as stored in the Prophet 600 memory or dumped SysEx files. It also applies to the panel overlay which some users have acquired to reflect the (slightly) altered function of some dials. 

\textbf{For users upgrading from version 2.1 RC3}

\textbf{For users upgrading from version 2.0}

\section{Credits and license}

The Firmware Upgrade project has been set up by GliGli as an open source project with a public code repository on GitHub\cite{repository}. 

(this needs to be done)

Despite the fact that many have contributed and have spent considerable time to make this software as useful and consistent as possible and despite the fact that many users continue to enjoy the upgrade, the usage of the software and this documentation are understood to be at the user's own risk.


\end{flowtext}

\chapter{Finding your way around your new  Prophet 600}    

\begin{flowtext}

\section{Display}

The 2 digit 7 segment display is used for different purposes.

\begin{itemize}
  \setlength\itemsep{0cm}
  \item Numeric controls: if the synth is in live mode (see section \ref{uimode}) and the user turns a dial, the display shows the value of the dial. A decimal point between the two digits indicates a negative value. Values range from -50 to 48 (signed parameters) or 0 to 98 (positive parameters). Note that this is a limitation of the display only and that the true resolution of the underlying parameters is higher for many parameters.  
  \item Parameter names and values: additional parameters are "hidden" in menus accessible via the key pad. The chosen parameter name and value are scrolled through the 2 digit display
  \item Messages such as the welcome message (software version) and confirmative messages (e.g. note of completion after a SysEx dump) are also scrolled through the display
  \item During the tuning procedure the current status is shown        
\end{itemize}

\section{Panel control}

(this needs to be done)

\section{Keyboard and performance section}

(this needs to be done)

\section{Key pad and parameter/settings menus}

With the firmware upgrade the Prophet 600 provides additional patch parameters and instrument settings. These are "hidden" in two new menus. The two menus are accessed using the \textbf{Number Pad} in the following way. 

\textbf{Additional patch parameters}

Note that the Prophet operates in two basic modes (live mode and preset mode, see section \ref{uimode} and the access to the additional patch parameters is different as commented in the text.

The additional patch parameters are stored with a patch. In live mode these parameters are accessed by pressing the buttons 0-9 (or pressing them twice or in some cases three times). The respective parameter name is scrolled through the display. The display then shows the value which is either numeric (shown) or a choice setting (scrolled through the display). The value change is done using the \textbf{Speed Dial} on the \textbf{Key Pad}. Important: in preset mode the display shows the patch (preset) number and by default the number pad is reserved for selecting the patch in this case. In order to access the additional patch parameters in preset mode the button \textbf{To Tape} must be activated (its LED will be lit).
       
The list of additional patch parameters can be found in section \ref{patchref}. Each parameter is explained in the respective functional context in the next chapter.

\textbf{Shift mode: miscellaneous settings}

The miscellaneous settings are patch independent but they are also stored, e.g. will be loaded the after switching the instrument off and on. The settings are accessed via the \textbf{Shift} mode. In this mode, different keys and buttons have a different function. To use this mode either hold down the button \textbf{From Tape} while selecting one of the additional functions or double click \textbf{From Tape} to enter \textbf{Shift Lock} mode (permanent shift) indicated by a blinking LED. To exit the mode push the button again. In shift mode the numbers 0...9 on the number pad access the miscellaneous settings (see section \ref{settingsref}). In addition, in shift mode the keys on the keyboard are used to set the keyboard transposition (see section \ref{transposition}) and the tuning button activates a per note tuning mode (see section \ref{tuning}).

Note that in contrast to the additional patch parameter pages, the miscellaneous settings associated with the numbers 0...9 are edited by pressing number key repeatedly to cycle through values or to initiate actions. The speed dial is not used. The first time a number is pressed (while holding From Tape) the display scrolls the current value or mode. Pressing the same number key again cycles through the values of that setting or confirms a certain action or mode change. The list of miscellaneuous settings can be found in section \ref{settingsref}. Each setting is explained in the respective functional context in the next chapter or in the appropriate section in the setup chapter.

\section{The work flow concept}

With the clearly laid out panel controls the the Prophet 600 is both, a hands-on performance instrument and sound sculpting synthesizer. The upgrade preserves that basic character. The controls on the panel have largely have the same function as in original except for some minor changes. However, the new functionalities of the upgrade required additional parameters and these had to be placed in the new menus. This has disadvantages. Diving into menus interrupts the work flow. It is abstract and unsatisfying. It is only acceptable for parameters which are rarely used and certainly not suited for live tweaking. Another improtant aspect is the perservation of the user interface concept. In particular, for each function there should be a unique and self-contained way to change it, instead of have a mix of say, dials and menues. This is one reason why he upgrade also contains "only" one LFO and two envelopes even though one might have added more with the new processor: this corresponds to the layout of the Prophet 600 and anything more would have meant at least a partial dive into menues. The upgraded Prophet 60 fulfills this ideal to a large degree but not fully. The LFO shape, for instance, is a mix of flipping a swithc on the control panel and choosing options in the additional patch parameter menu. However, this is one of a few notable exceptions.

A useful work flow of the upgraded Prophet 600 for creating or editing patches could be as follows:

\begin{enumerate}
  \item Pre-production: Set basic overall patch parameters, such as envelope shapes and routing, LFO targets and range 
  \item Production: Use the panel controls to interactively design the sound 
  \item Post-production: add additional features, such as vibrato and bend modulation for a final touch
\end{enumerate} 

Ideally, menu diving should be largely restricted to steps 1 and 3 so that uninterrupted hands-on and interactive work with the synthesizer is possible in step 2. It may not always be possible to finalize step 1 upfront and the user may occasionally have to go back to step 1.Nevertheless, the workflow should be more or less natural.

\section{Inputs and outputs}

\textbf{Power Switch}

When turning on the Prophet 600 with the upgrade installed the version is scrolled through the display. Then, the display will show and remain on the patch number selected when the instrument was last powered off.

Note: some earlier versions immediately went into tuning mode (see section \ref{tuning})  when powered up. From version 2.1 on the OS does not. This is to allow the instrument to warm up and stabilize, which typically takes approximately 10 to 15 minutes. Warm up time can depend on changes in air temperature, humidity and transportation of the instrument, as well as the condition of hardware such as the power supply. Therefore, after powering up, wait at least 5 to 20 minutes, and then, as needed, the TUNE button can be pressed to ensure optimal performance. If practical, allowing the instrument to warm up will result in less need to run the tune procedure and overall longer tuning stability.

\textbf{Line voltage selector}

The selector next to the main plug provides the option to switch between 110V and 220V mains voltage, whichever is appropriate for the line voltage where the instrument is operated. A flat head screw driver can be used to rotate the line voltage selector to the appropriate setting. Instrument should be powered down and unplugged when line voltage selector is adjusted.

\textbf{Fuse holder}

Fit the fuse according to the selected line voltage, e.g. 110V 1/2A, slo-blo, 220V 1/4A slo-blo.

\textbf{Audio out / headphone jack}

To drive a preamp or amp, a standard monophonic cable can be used. Or if there are two audio destinations (perhaps one to remain “dry” while the other is processed), a stereo cable may be more convenient.

The Prophet 600 has a monophonic output signal, but the jack is wired so that both sides of standard stereo headphones can be driven. The headphones have a minimum impedance of 1200 Ohms per element (600 Ohms in parallel).

\textbf{Filter CV In}

This jack accepts a 0-10 Vdc control voltage (CV) which raises programmed filter frequency settings. This enables remote and spontaneous increase (but not decrease) of brightness. This CV is usually provided by an accessory voltage pedal.

\textbf{Foot switch}

The foot switch jack allows for the use of a sustain pedal (only supported from GliGli 2.1 onwards). The pedal should be contact open at rest (for example a Fatar PS100 will function correctly).

\textbf{Cassette In/Out (disabled with GliGli mod)}

In the upgrade version there is no way to receive or send patch data via Cassette In/Out. Cassette In can be used for sending a pulsed clock to the Prophet 600 to sync the sequencer and/or arpeggiator.

\textbf{MIDI In/Out}

(this needs to be done)

\chapter{Functionality}

\section{Operating modes: preset and live mode}\label{uimode}

\include{uimode.tex}

\section{Loading and storing presets}\label{loadstorepatches}

\include{loadstorepatches}

\section{Oscillator and mix}\label{osc}

\include{osc.tex}

\section{Volume and global tune}

To the right of the panel there two global parameter dials, the \textbf{Master Tune} and \textbf{Volume} dials. The master tuning has a range or approximately $\pm$semitone. It's pupose is to be able to tune the synth to other instruments without touching the internal, relative frequencies of the oscillators and thereby potentially changing the patch.

\section{Filter}\label{filter}

\include{filter.tex}

\section{Envelopes and routing}\label{envelopes}

\include{envelopes.tex}

\section{Polyphonic, unison and chord mode, voice assignment priority}\label{poly-unison-voice}

\include{poly-unison-voice.tex}

\section{LFO}\label{lfo}

\include{lfo.tex}

\section{Poly-Mod}\label{polymod}

\include{polymod.tex}

\section{Arpeggiator}\label{arp}

\include{arp.tex}

\section{Sequencer}\label{seq}

\include{seq.tex}

\section{Vibrato}\label{vib}

\include{vibrato.tex}

\section{Pitch bender}\label{pitchbend}

\include{pitchbend.tex}

\section{Modulation wheel and modulation delay}\label{modwheel}

\include{modwheel.tex}

\section{Glide}\label{glide}

In the original Prophet 600 the glide setting (the glide time) had a dedicated dial. In the upgraded Prophet 600 the dial has been re-designated to control the amplitude of OSC B. As a consequence the glide time has been moved to the additional patch parameter \textbf{(7) Glide}. 

\section{Detune}\label{detune}

The upgraded Prophet 600 provides a method to detune the 6 voices against one another. This effect can be used in particular to make unison sound broader and more lively. The additional patch parameter is \textbf{(77) Detune}

\chapter{Synthesizer setup and maintenance}

\section{Tuning}\label{tuning}

The Prophet 600 is a VCO synthesizer, e.g. the frequency of the oscillators A and B are set by apllying a voltage to the control pin of the microchip. The relationship between absolute voltage and resulting frequency is not precise. It depends on many factors, such as smallest differences in the manufacturing process of the chip itself and the surrounding circuit components and operating temparture (the temparture of the components also changes during operation). Therefore the synthesizer need to be tuned regularly. Typically, tuning is best after the instrument (or rather: the chips and components) has been given time to warm up to a stable operating temperature, which could be 10-30 minutes into operation. It may be necessary to retune the synth during operation. The user should trust her or his ear on this.

The automated tuning procedure applies 12 note equal tempered tuning. For other tunings each of the 12 notes can be tuned manually. The per note tuning is stored as part of the patch (in contrast to the overall tuning, which is stored as part of the settings and applies to all presets) and it is retained after full tuning. To enter the per note tuning hold down From Tape and press Tune. The Tune button flashes. In this mode the last played note is tuned using the mod wheel. From the middle position the tune range is $\pm$1 semitone from equal tempered. To leave the per note tuning mode press Tune again.

\section{MIDI integration}\label{midiintegration}

\include{midiintegration.tex}

\section{Voice deactivation}

The upgrade Prophet 600 provides a method for switching single voices of the Prophet 600 off. This can be useful to suppress a voice that is damaged or for troubleshooting, e.g. isolating voices for testing. The "voice masking" is done using the settings 4 and 5:
\begin{enumerate}
  \setlength\itemsep{0cm}
  \item Pressing key 4 while holding down From Tape repeatedly cycles through the 6 voice of the Prophet 600. This selection determines the functionality of the key 5 in the setting menu.
  \item Key 5 toggles between on and off of the voice selected using key 4. In the upgrade Prophet 600 the user can deactivate selected voices in this way.
\end{enumerate}

\section{Transposition}

The upgraded Prophet 600 provides a method for transposing the keyboard. In shift mode the last pressed key will define the transposition, the middle C3 being zero transposition. The value is also scrolled through the display for conformation. 

Transposition also applies to arpeggiator and sequencer. The transposition procedure also works in the respective run, latch and record modes.

\section{External sequencer/arpeggiator sync}\label{sync}

The sequencer and arpeggiator of the upgraded Prophet 600 can be sync'ed to external clock sources. This is done using the miscellaneous setting of number key "8". Pressing key "8" repeatedly cycles through the sync source. The supported sources are \textit{internal} (default setting, the Prophet 600 generates its own clock.), \textit{MIDI} (fraction of the incoming MIDI clock on the received channel will be used as clock) and \textit{tape} (a pulse clock source can be plugged into the “Cassette In” jack and a fraction of it will be used as clock).

\section{Spread}\label{spreadsett}

\include{spread.tex}

\section{VCF limit}\label{limitsett}

In the upgraded Prophet 600 it is possible to limit the cut-off frequency of the filter to 22kHz in order to avoid strange filter behaviour in the ultrasonic range.

In the miscellaneous settings menu the VCF limit setting is combined with the spread setting. It can be accessed using the key "9".  

\section{Managing sound libraries via SysEx}\label{mididump}

\include{patchmgmt.tex}

\section{Scaling adjustment}\label{maintenance}

\include{maintenancemode.tex}

\section{SysEx firmware upgrade}\label{fwupgrade}

For a firmware upgrade in a Prophet 600 with an original Z80 processor please refer to the modification instructions \cite{modinstructions}. The following section is for owners of a modified Prophet 600 with Teensy board and a prior version of the GliGli upgrade installed. If modifying a Prophet 600 for the time one may directly flash the Teensy board with software version 2.2. It is not necessary to first install a lesser version and then upgrade.

Firmware upgrades are provided as MIDI SysEx files (*.syx) \footnote{They are also provided as *.hex files for USB transfer to the Teensy board.}. In order to perform the upgrade follow to step below.

\begin{enumerate}
  \setlength\itemsep{0cm}
  \item Switch off the instrument
  \item Switch on the instrument while holding the buttons \textbf{To Tape} and \textbf{From Tape} down. The display should show an "U" for upgrade on the left digit.
  \item Send the firmware SysEx file to the instrument. This process takes a while. The display shows a spinning segment. Once the process is completed, the display shows an "S" for success. If the upgrade ends with “E” for error on the display, the upgrade has failed and the upgrade procedure must be repeated until it succeeds. It is not recommended to start the instrument in normal mode after a failed upgrade.
  \item Switch the instrument off and on again. The scrolled welcome message should state the version "GliGli's P600 Upgrade Version \textit{<version>}"
\end{enumerate}

Users are recommended to follow the MIDI SysEx part of the modification instructions \cite{modinstructions}. In particular, the "Delay between buffers" and the "delay after F7" should be set to at least 250ms.

The settings and preset parameters are left unchanged by the upgrade, provided the previously installed version is one for which backward compatibility is supported. This applies to the following versions:

\begin{itemize}
  \setlength\itemsep{0cm}
  \item Version 2.0
  \item Version 2.1 Release Candidate 3 (not officially released)
  \item Version 2.2  
\end{itemize} 

Downgrading versions is possible but preservation of settings and preset parameters is not guaranteed in that case.

\end{flowtext}

\chapter{Reference}

\section{Patch parameter overview}\label{patchref}

\include{patchref.tex}

\section{Settings parameter overview}\label{settingsref}

\include{settingsref}

\section{MIDI control implementation}\label{midiimplenentation}

\include{midiimplementation.tex}

\chapter{Technical reference for the GliGli upgrade}

\section{Clock cycle}

(this nees to be done)

\section{Settings storage}

(this nees to be done)

\section{Patch storage}

(this nees to be done)

\chapter{Troubleshooting}

(this nees to be done)

\begin{thebibliography}{50} 

\bibitem{gligli}GliGli Projects Page, http://gliglisynth.blogspot.com/
\bibitem{curtis}Curtis Electro Music on Webarchive, https://web.archive.org/web/20130502132536/http://curtiselectromusic.com/Customers\_and\_Instruments.html
\bibitem{versiontwo}GliGli upgrade release 2.0,  https://gligli.github.io/p600fw/
\bibitem{modinstructions} Prophet600 Modification Instructions
\bibitem{projectsite} Project Site: http://gligli.github.io/p600fw/
\bibitem{repository} Repository: https://github.com/gligli/p600fw/
\bibitem{teensy}Teensy Site: http://www.pjrc.com/teensy/index.html
\bibitem{p600siownersmanual}Prophet 600 Owner's Manual, Sequential Circuits
\bibitem{p600siservicemanual} Prophet 600 Service Manual, Sequential Circuits

\end{thebibliography}

\end{document}
